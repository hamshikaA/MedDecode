<!DOCTYPE html>
<html>
<head>
    <title>MedDecode</title>

    <style>
        body{
            font-family: Arial;
            margin:0;
            padding:0;
            min-height:100vh;
            background: url("/static/images/stethoscope.jpg") no-repeat center center fixed;
            background-size: cover;
            display:flex;
            justify-content:center;
            align-items:flex-start;
     background: url("/static/images/stethoscope.jpg") no-repeat center center fixed;
    background-size: cover;

        }
        body::before{
            content:"";
            position:fixed;
            top:0; left:0;
            width:100%; height:100%;
            background: rgba(255,255,255,0.55);
            backdrop-filter: blur(1x);
            z-index:-1;
        }
        .container{
            max-width:800px;
            width:100%;
            margin:40px;
            padding:25px;
            background: rgba(255,255,255,0.85);
            border-radius:15px;
            box-shadow:0 10px 30px rgba(0,0,0,0.2);
        }
        h1{
            text-align:center;
            color:#2c3e50;
            animation: jumpIn 1s ease-out forwards;
            opacity:0;
        }

        @keyframes jumpIn{
            0%{transform:translateY(80px); opacity:0;}
            60%{transform:translateY(-10px);}
            100%{transform:translateY(0); opacity:1;}
        }

        form{text-align:center;margin-bottom:30px;}

        button{
            padding:10px 18px;
            background:#3498db;
            color:white;
            border:none;
            border-radius:6px;
            cursor:pointer;
            font-size:14px;
        }

        button:hover{background:#2288cd;}

        .output{
            background: rgba(236,240,241,0.95);
            padding:20px;
            border-radius:12px;
            animation: fadeUp 0.8s ease-out;
        }

        @keyframes fadeUp{
            from{opacity:0; transform:translateY(20px);}
            to{opacity:1; transform:translateY(0);}
        }

        .hover-term{
            border-bottom:1px dashed #2c3e50;
            cursor:help;
        }

        .controls-container{
            margin-top:15px;
        }

        .controls-container button,
        .controls-container a{
            margin-right:10px;
        }

        audio{
            margin-top:15px;
            width:100%;
        }

        .insights{
            background:#dfe6e9;
            padding:12px;
            margin-top:20px;
            border-radius:8px;
        }

       select{
    padding:8px 12px;
    border-radius:6px;
    border:2px solid #3498db;
    background:#ecf6ff;
    color:#2c3e50;
    font-weight:600;
    cursor:pointer;
}

select:focus{
    outline:none;
    border-color:#1abc9c;
    background:#e8fff8;
}

    </style>
</head>

<body>
 
<div class="container">

<h1>MED-DECODE Report Translator</h1>

<form method="POST" enctype="multipart/form-data">
    <input type="file" name="file" required>
    <button type="submit">Decode</button>
</form>

{% if error %}
<p style="color:red;text-align:center;">{{ error }}</p>
{% endif %}

{% if output %}
<div class="output">

    <h3>Decoded Successfully</h3>

    <p id="outputText">
        {% set text = translations["en"] %}
        {% for term in hover_terms %}
            {% set text = text.replace(term, '<span class="hover-term" title="'+term+'">'+term+'</span>') %}
        {% endfor %}
        {{ text | safe }}
    </p>

    <div class="controls-container">
        <label>Choose Language:</label>
        <select id="lang">
            <option value="en" selected>English</option>
            <option value="ta">Tamil</option>
            <option value="hi">Hindi</option>
        </select>
        <button type="button" onclick="playVoice()">ðŸ”Š Read Aloud</button>
        <a id="downloadBtn" href="/download/en" download>â¬‡ Download Audio</a>
    </div>

    <audio id="audio" controls>
        <source src="{{ audio_files['en'] }}" type="audio/mpeg">
    </audio>

    <div class="insights">
        <h4>Key Insights</h4>
        <ul>
        {% if insights %}
            {% for item in insights %}
                <li>{{ item }}</li>
            {% endfor %}
        {% else %}
            <li>No key medical terms found in the report.</li>
        {% endif %}
        </ul>
    </div>

</div>

<script>
const translations = {
    "en": `{{ translations["en"] | safe }}`,
    "ta": `{{ translations["ta"] | safe }}`,
    "hi": `{{ translations["hi"] | safe }}`
};

const audioFiles = {
    "en": `{{ audio_files["en"] | safe }}`,
    "ta": `{{ audio_files["ta"] | safe }}`,
    "hi": `{{ audio_files["hi"] | safe }}`
};

const langSelect = document.getElementById("lang");
const audioEl = document.getElementById("audio");
const downloadBtn = document.getElementById("downloadBtn");

langSelect.addEventListener("change", function(){
    const lang = langSelect.value;
    document.getElementById("outputText").innerHTML = translations[lang];
    audioEl.src = audioFiles[lang];
    audioEl.load();
    downloadBtn.href = `/download/${lang}`;
});

function playVoice(){
    audioEl.play();
}
</script>
{% endif %}

</div>
</body>
</html>
